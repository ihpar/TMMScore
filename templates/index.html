<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>&#6158;&nbsp;TMM Katip</title>
    <link rel="shortcut icon" href="static/img/b45.png">
    <!-- font -->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <script type="text/javascript" src="{{ url_for('static', filename='js/vexflow-debug.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/snap.svg.js') }}"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='style/site.css') }}">
    <style type="text/css">
        html, body {
            font-family: 'JetBrains Mono', monospace;
            font-size: 12pt;
            color: #333841;
            height: 100%;
        }

        body {
            overflow-y: scroll;
            background-color: #fff;
        }

        .dv-main-wrapper {
            display: flex;
            justify-content: center;
            height: 100%;
        }

        .dv-center-content {
            padding-top: 1rem;
            width: auto;
        }

        #dv-top {
            width: 100%;
            padding: 1rem;
        }

        #dv-score-wrapper {
            width: 100%;
        }

        .shadowed {
            position: relative;
            margin-bottom: 2rem;
        }

        .shadowed:before, .shadowed:after {
            z-index: -1;
            position: absolute;
            content: "";
            bottom: 15px;
            left: 10px;
            width: 50%;
            top: 80%;
            max-width: 300px;
            background: #999;
            -webkit-box-shadow: 0 15px 10px #999;
            -moz-box-shadow: 0 15px 10px #999;
            box-shadow: 0 15px 10px #999;
            -webkit-transform: rotate(-3deg);
            -moz-transform: rotate(-3deg);
            -o-transform: rotate(-3deg);
            -ms-transform: rotate(-3deg);
            transform: rotate(-3deg);
        }

        .shadowed:after {
            -webkit-transform: rotate(3deg);
            -moz-transform: rotate(3deg);
            -o-transform: rotate(3deg);
            -ms-transform: rotate(3deg);
            transform: rotate(3deg);
            right: 10px;
            left: auto;
        }
    </style>
</head>
<body>
<div class="dv-main-wrapper">
    <div class="dv-center-content">
        <div id="dv-top">
            Aşağıdaki menüden notalarınızı yazın!
        </div>
        <div id="dv-score-wrapper"></div>
        <div id="dv-tmm-wrapper" class="shadowed"></div>
    </div>
</div>
<script type="text/javascript">
    /*
    VF = Vex.Flow;

    let div = document.getElementById("dv-score-wrapper");
    let width = div.offsetWidth * 2;

    let renderer = new VF.Renderer(div, VF.Renderer.Backends.SVG);

    // Size our SVG:
    renderer.resize(width, width / 2);

    // And get a drawing context:
    let context = renderer.getContext();

    // Create a stave at position 10, 40 of width 400 on the canvas.
    let off_left = 10;
    let off_top = 10;
    let s_width = width - (off_left * 2);
    let stave = new VF.Stave(off_left, off_top, s_width);

    // Add a clef and time signature.
    stave.addClef("treble").addTimeSignature("012345/6789");

    // Connect it to the rendering context and draw!
    stave.setContext(context).draw();

    let notes = [
        new VF.StaveNote({clef: "treble", keys: ["a/4"], duration: "32"}).addAccidental(0, new VF.Accidental("bss")),
        new VF.StaveNote({clef: "treble", keys: ["a/4"], duration: "16"}).addAccidental(0, new VF.Accidental("b")),
        new VF.StaveNote({clef: "treble", keys: ["a/4"], duration: "8"}).addAccidental(0, new VF.Accidental("bs")),
        new VF.StaveNote({clef: "treble", keys: ["a/4"], duration: "4"}).addAccidental(0, new VF.Accidental("d")),
        new VF.StaveNote({clef: "treble", keys: ["a/4"], duration: "2"}).addAccidental(0, new VF.Accidental("+")),
        new VF.StaveNote({clef: "treble", keys: ["a/4"], duration: "1"}).addAccidental(0, new VF.Accidental("#")),
        new VF.StaveNote({clef: "treble", keys: ["a/4"], duration: "8d"}).addAccidental(0, new VF.Accidental("+-")).addDot(0),
        new VF.StaveNote({clef: "treble", keys: ["a/4"], duration: "4"}).addAccidental(0, new VF.Accidental("++-")).addDot(0)
    ];

    VF.Formatter.FormatAndDraw(context, stave, notes);
    */

    const symbols = {
        b8: "m 150.20304,75 m 0.0274,-13.1328 v 2.02464 c 0,0.16416 0.0821,0.30096 0.30096,0.30096 0.0547,0 1.75104,-0.62928 1.83312,-0.65664 0.19152,0 0.2736,0.10944 0.2736,0.19152 0,0.35568 0,0.71136 0.0547,0.98496 0,0.32832 -0.0547,0.4104 -0.24624,0.46512 -0.16416,0.08208 -1.80576,0.76608 -1.80576,0.76608 -0.2736,0 -0.4104,0.08208 -0.4104,0.2736 v 1.99728 c 0,0.16416 0.0821,0.32832 0.32832,0.32832 0.0821,0 1.58688,-0.60192 1.80576,-0.71136 0.2736,0 0.35568,0.16416 0.35568,0.30096 0.0821,6.23808 0.24624,13.32432 0.4104,13.48848 0.10944,0.19152 0.21888,0.24624 0.35568,0.24624 0.10944,0 0.21888,-0.08208 0.21888,-0.08208 1.17648,-0.62928 2.16144,-1.75104 3.06432,-2.40768 3.47472,-2.43504 4.73328,-4.81536 4.73328,-6.67584 0,-2.24352 -1.72368,-3.61152 -3.52944,-3.72096 -0.684,0 -1.5048,0.30096 -2.10672,0.65664 -0.30096,0.16416 -0.62928,0.5472 -0.98496,0.5472 -0.0274,0 -0.0821,-0.02736 -0.10944,-0.02736 -0.2736,-0.10944 -0.43776,-0.4104 -0.43776,-0.71136 0,-0.19152 0,-0.90288 0.0547,-1.80576 0,-0.16416 0,-0.5472 0.2736,-0.62928 0.2736,-0.1368 5.55408,-2.052 5.55408,-2.052 0.21888,-0.08208 0.35568,-0.24624 0.35568,-0.43776 v -1.88784 c 0,-0.16416 -0.0547,-0.32832 -0.24624,-0.32832 -0.10944,0 -5.472,1.96992 -5.63616,2.052 -0.0274,0 -0.21888,-0.10944 -0.21888,-0.19152 0.0274,-0.35568 0.0274,-0.87552 0.0274,-1.0944 0,-0.24624 0.10944,-0.35568 0.2736,-0.43776 0.16416,-0.08208 5.44464,-2.02464 5.44464,-2.02464 0.21888,-0.05472 0.35568,-0.21888 0.35568,-0.38304 v -1.94256 c 0,-0.1368 -0.0547,-0.30096 -0.24624,-0.30096 -0.10944,0 -5.36256,1.9152 -5.472,1.96992 -0.19152,0 -0.2736,-0.10944 -0.2736,-0.19152 0,-0.76608 0.0274,-1.2312 0.0274,-1.39536 0,-0.43776 -0.35568,-0.62928 -0.73872,-0.62928 -0.5472,0 -1.17648,0.4104 -1.2312,1.12176 v 1.69632 c 0,0.05472 -0.0274,0.2736 -0.21888,0.30096 -0.1368,0.08208 -1.7784,0.71136 -1.7784,0.71136 -0.2736,0.02736 -0.4104,0.16416 -0.4104,0.30096 m 4.18608,11.13552 c 0.16416,-0.51984 1.17648,-1.39536 1.7784,-1.69632 0.35568,-0.16416 0.65664,-0.24624 0.98496,-0.24624 0.38304,0 0.73872,0.10944 1.01232,0.38304 0.35568,0.43776 0.60192,1.06704 0.60192,1.86048 0,2.16144 -1.72368,4.26816 -3.50208,5.30784 -0.16416,0.08208 -0.2736,0.1368 -0.35568,0.1368 -0.32832,0 -0.43776,-0.4104 -0.43776,-0.62928 0,0 -0.10944,-2.51712 -0.10944,-4.07664 0,-0.49248 0,-0.90288 0.0274,-1.03968",
        b5: "m 189.316,75 m 0.46512,6.7032 c 0.1368,0.16416 0.24624,0.19152 0.35568,0.19152 0.1368,0 0.24624,-0.08208 0.24624,-0.08208 1.17648,-0.65664 2.13408,-1.72368 3.11904,-2.40768 3.50208,-2.43504 4.70592,-4.84272 4.70592,-6.64848 0,-2.24352 -1.72368,-3.66624 -3.52944,-3.77568 -0.684,0 -1.61424,0.30096 -2.16144,0.65664 -0.24624,0.19152 -0.684,0.5472 -0.87552,0.5472 -0.0821,0 -0.10944,0 -0.19152,-0.02736 -0.2736,-0.10944 -0.43776,-0.4104 -0.43776,-0.684 0.0274,-0.84816 0.2736,-10.31472 0.2736,-11.10816 0,-0.43776 -0.35568,-0.65664 -0.73872,-0.65664 -0.57456,0 -1.20384,0.38304 -1.2312,1.0944 0,0 0.16416,22.48992 0.46512,22.90032 m 1.34064,-8.70048 c 0.2736,-0.79344 1.86048,-1.94256 2.76336,-1.94256 1.14912,0 1.61424,1.31328 1.61424,2.29824 0,2.10672 -1.80576,4.2408 -3.50208,5.30784 -0.16416,0.08208 -0.2736,0.10944 -0.38304,0.10944 -0.35568,0 -0.43776,-0.38304 -0.43776,-0.57456 0,0 -0.1368,-2.38032 -0.1368,-3.93984 0,-0.62928 0.0547,-1.12176 0.0821,-1.25856",
        b4: "M 0.0072,0.275054 M 0,-1.520218 c 0,0.04343 0.01447,0.08687 0.07239,0.08687 0.02172,0 0.499491,-0.180975 0.521208,-0.202692 0.03619,0 0.05791,0.02172 0.05791,0.04343 0.02172,1.650492 0.05067,3.576066 0.108585,3.641217 0.02896,0.04343 0.05791,0.05067 0.07963,0.05067 0.03619,0 0.06515,-0.02172 0.06515,-0.02172 C 1.21615,1.91106 1.476754,1.6215 1.737358,1.440525 2.66395,0.796254 2.989705,0.151983 2.989705,-0.33303 c 0,-0.593598 -0.463296,-0.955548 -0.94107,-0.984504 -0.05791,0 -0.130302,0.0072 -0.195453,0.02896 -0.123063,0.02896 -0.238887,0.07239 -0.376428,0.14478 -0.07239,0.05067 -0.188214,0.137541 -0.231648,0.137541 -0.02172,0 -0.03619,0 -0.05791,-0.01448 -0.07239,-0.01448 -0.115824,-0.09411 -0.115824,-0.166497 0,-0.05791 0.02172,-0.477774 0.02172,-0.535686 0,-0.07963 0.02896,-0.09411 0.05791,-0.108585 0.03619,-0.0072 1.483995,-0.571881 1.483995,-0.571881 0.07239,-0.02172 0.101346,-0.06515 0.101346,-0.101346 v -0.50673 c 0,-0.02896 -0.0072,-0.09411 -0.05791,-0.09411 -0.01447,0 -0.03619,0 -0.04343,0.01448 0,0 -1.418844,0.521208 -1.462278,0.542925 -0.05067,0 -0.05791,-0.03619 -0.05791,-0.06515 0.0072,-0.687705 0.02896,-1.404366 0.02896,-1.512951 0,-0.115824 -0.09411,-0.173736 -0.195453,-0.173736 -0.137541,0 -0.304038,0.101346 -0.318516,0.28956 0,0 0,0.658749 0.01447,1.556385 0,0.02896 0,0.123063 -0.08687,0.152019 L 0.09411,-2.121061 C 0.02896,-2.113861 0,-2.092101 0,-2.041431 m 1.078611,2.121027 c 0,-0.166497 0.01447,-0.296799 0.02172,-0.332994 0.07239,-0.231648 0.492252,-0.513969 0.752856,-0.513969 0.311277,0 0.412623,0.325755 0.412623,0.593598 0,0.586359 -0.456057,1.143762 -0.948309,1.418844 -0.03619,0.02172 -0.07239,0.02896 -0.101346,0.02896 -0.07963,0 -0.101346,-0.09411 -0.101346,-0.152019 0,0 -0.03619,-0.629793 -0.03619,-1.042416",
        b1: "m 270.90014,75 m 4.76064,4.40496 c 0.98496,0.684 1.94256,1.75104 3.11904,2.40768 0,0 0.10944,0.08208 0.24624,0.08208 0.10944,0 0.21888,-0.02736 0.35568,-0.19152 0.30096,-0.4104 0.46512,-22.90032 0.46512,-22.90032 -0.0547,-0.71136 -0.684,-1.0944 -1.2312,-1.0944 -0.38304,0 -0.73872,0.21888 -0.73872,0.65664 0,0.79344 0.24624,10.26 0.2736,11.10816 0,0.2736 -0.16416,0.57456 -0.43776,0.684 -0.0821,0.02736 -0.10944,0.02736 -0.19152,0.02736 -0.19152,0 -0.62928,-0.35568 -0.87552,-0.5472 -0.5472,-0.35568 -1.47744,-0.65664 -2.16144,-0.65664 -1.80576,0.10944 -3.5568,1.53216 -3.5568,3.6936 0,1.88784 1.2312,4.29552 4.73328,6.73056 M 273.6635,73.3584 c 0,-0.98496 0.46512,-2.29824 1.61424,-2.29824 0.90288,0 2.48976,1.14912 2.76336,1.94256 0.0274,0.1368 0.0821,0.62928 0.0821,1.25856 0,1.55952 -0.1368,3.93984 -0.1368,3.93984 0,0.19152 -0.0821,0.57456 -0.43776,0.57456 -0.10944,0 -0.21888,-0.02736 -0.38304,-0.10944 -1.69632,-1.06704 -3.50208,-3.20112 -3.50208,-5.30784",
        d1: "m 326.48939,75 m 0.32832,8.6184 c 0.1368,0 1.75104,-0.71136 1.99728,-0.8208 0.19152,-0.08208 0.5472,0.43776 0.5472,0.73872 v 4.9248 c 0,0.24624 0.24624,0.43776 0.5472,0.43776 0.60192,0 0.684,-0.2736 0.684,-0.65664 V 82.7976 c 0,-0.10944 0,-0.19152 0.0274,-0.30096 0.0547,-0.24624 0.19152,-0.49248 0.35568,-0.57456 0.32832,-0.05472 2.07936,-0.76608 2.07936,-0.76608 0.24624,-0.08208 0.49248,-0.4104 0.49248,-0.62928 v -2.81808 c 0,-0.21888 -0.1368,-0.35568 -0.32832,-0.35568 -0.0274,0 -0.10944,0.05472 -0.16416,0.05472 v -0.05472 c 0,0 -1.80576,0.76608 -1.96992,0.79344 -0.2736,0 -0.5472,-0.21888 -0.5472,-0.65664 v -3.66624 c 0,-0.32832 0.21888,-1.03968 0.51984,-1.14912 0.35568,-0.16416 1.99728,-0.79344 1.99728,-0.79344 0.24624,-0.10944 0.49248,-0.38304 0.49248,-0.65664 V 68.4336 c 0,-0.21888 -0.16416,-0.32832 -0.32832,-0.32832 -0.0274,0 -0.10944,0 -0.16416,0.02736 0,0 -1.88784,0.71136 -1.96992,0.71136 -0.32832,0 -0.49248,-0.4104 -0.49248,-0.76608 v -4.73328 c 0,-0.24624 -0.24624,-0.43776 -0.5472,-0.43776 -0.60192,0 -0.684,0.35568 -0.684,0.65664 v 5.14368 c 0,0.30096 -0.10944,0.76608 -0.38304,1.01232 -0.71136,0.2736 -1.34064,0.60192 -2.02464,0.87552 -0.21888,0.08208 -0.46512,0.38304 -0.46512,0.62928 v 2.79072 c 0,0.24624 0.10944,0.35568 0.32832,0.35568 0.0274,0 0.10944,-0.02736 0.1368,-0.02736 0,0 1.53216,-0.684 1.86048,-0.79344 0.0274,0 0.0821,-0.05472 0.10944,-0.05472 0.24624,0 0.49248,0.35568 0.49248,0.684 v 3.93984 c 0,0.43776 -0.16416,0.79344 -0.4104,0.84816 l -2.052,0.87552 c -0.21888,0.08208 -0.46512,0.4104 -0.46512,0.62928 v 2.79072 c 0,0.24624 0.10944,0.35568 0.32832,0.35568",
        d4: "m 1e-5,0.04028037 m 0.0869,-0.267843 c 0.0362,0 0.23889,-0.09411 0.26785,-0.115824 0.007,0 0.0217,-0.01448 0.0289,-0.01448 0.0724,0 0.13754,0.108585 0.13754,0.188214 v 1.035177 c 0,0.115824 -0.0507,0.20993103 -0.11582,0.23888703 -0.0579,0.02172 -0.28232,0.115824 -0.28232,0.115824 C 0.05066,1.2419554 0,1.3215814 0,1.3867324 v 0.738378 c 0,0.06515 0.029,0.09411 0.0869,0.09411 0.007,0 0.029,-0.0072 0.0362,-0.0072 0,0 0.14478,-0.06515 0.23889,-0.09411 0.0145,-0.01448 0.0217,-0.01448 0.0362,-0.01448 0.0724,0 0.12306,0.115824 0.12306,0.166497 v 1.281303 c 0,0.06515 0.0652,0.115824 0.13754,0.115824 0.10135,0 0.17374,-0.05067 0.17374,-0.115824 v -1.4478 c 0,-0.137541 0.0507,-0.209931 0.10859,-0.231648 l 0.62979,-0.260604 c 0.0145,0 0.0362,-0.0072 0.0434,-0.0072 0.0869,0 0.13754,0.123063 0.13754,0.188214 v 1.30302 c 0,0.06515 0.0652,0.115824 0.13754,0.115824 0.10859,0 0.17374,-0.05067 0.17374,-0.115824 v -1.483995 c 0,-0.07963 0.0434,-0.202692 0.11582,-0.238887 0.0724,-0.02896 0.28956,-0.115824 0.28956,-0.115824 0.0724,-0.02896 0.13031,-0.108585 0.13031,-0.173736 V 0.34439237 c 0,-0.05067 -0.0362,-0.08687 -0.0796,-0.08687 -0.0145,0 -0.029,0 -0.0507,0.01448 l -0.26784,0.101346 c -0.0652,0 -0.13754,-0.06515 -0.13754,-0.188214 v -0.970026 c 0,-0.07239 0.0507,-0.26784297 0.13754,-0.30403797 l 0.26784,-0.101346 c 0.0724,-0.02896 0.13031,-0.115824 0.13031,-0.173736 v -0.745617 c 0,-0.05067 -0.0362,-0.07963 -0.0796,-0.07963 -0.0145,0 -0.029,0 -0.0507,0.0072 0,0 -0.20993,0.08687 -0.2606,0.09411 -0.0724,0 -0.14478,-0.05067 -0.14478,-0.130302 v -1.274064 c 0,-0.06515 -0.0652,-0.115824 -0.14478,-0.115824 -0.10135,0 -0.1665,0.05067 -0.1665,0.115824 v 1.353693 c -0.0145,0.101346 -0.0434,0.238887 -0.13754,0.304038 -0.12306,0.07239 -0.47777,0.21717 -0.65875,0.260604 -0.0869,0 -0.12306,-0.123063 -0.12306,-0.209931 v -1.252347 c 0,-0.05791 -0.0724,-0.115824 -0.14478,-0.115824 -0.10135,0 -0.1665,0.05791 -0.1665,0.115824 v 1.411605 c 0,0.14478 -0.0652,0.246126 -0.12306,0.275082 -0.0651,0.03619 -0.27508,0.115824 -0.27508,0.115824 -0.0724,0.02172 -0.12306,0.108585 -0.12306,0.166497 v 0.74557997 c 0,0.05791 0.029,0.09411 0.0869,0.09411 m 0.71666,0.57912 c 0,-0.318516 0.007,-0.687705 0.029,-0.767334 0.0217,-0.180975 0.49949,-0.398145 0.7601,-0.398145 0.0724,0 0.13754,0.02172 0.15925,0.06515 0.0217,0.05067 0.0434,0.311277 0.0434,0.593598 0,0.282321 -0.0217,0.571881 -0.0434,0.665988 -0.0651,0.209931 -0.55016,0.412623 -0.79629,0.412623 -0.0579,0 -0.10858,-0.01448 -0.12306,-0.05067 -0.0217,-0.04343 -0.029,-0.267843 -0.029,-0.521208",
        d5: "m 58.123209,57.296292 m -0.007,0.325755 v 0.673227 c 0,0.05067 0.0289,0.115824 0.0941,0.115824 l 1.46951,-0.542925 c 0.029,0 0.0362,0.01448 0.0362,0.0362 v 0.152019 c 0,0.07239 -0.007,0.108585 -0.0724,0.123063 -0.0579,0.03619 -0.80353,0.332994 -0.80353,0.332994 -0.0724,0.03619 -0.12306,0.108585 -0.12306,0.180975 v 0.738378 c 0,0.05067 0.029,0.08687 0.0724,0.08687 0.0217,0 0.029,0 0.0507,-0.01448 0,0 0.7239,-0.28956 0.79629,-0.311277 0.0796,0 0.0796,0.01448 0.0796,0.115824 v 1.397127 c 0,0.06515 0.0651,0.115824 0.13754,0.115824 0.15926,0 0.18097,-0.07239 0.18097,-0.166497 v -1.4478 c 0,-0.03619 0,-0.05791 0.007,-0.07963 0.0217,-0.05791 0.0507,-0.123063 0.10135,-0.14478 0.0724,-0.02896 0.83972,-0.318516 0.83972,-0.318516 0.0724,-0.03619 0.12307,-0.108585 0.12307,-0.180975 v -0.738378 c 0,-0.05067 -0.0217,-0.08687 -0.0724,-0.08687 -0.0145,0 -0.0362,0 -0.0507,0.01448 l -0.84696,0.318516 c -0.0724,0 -0.10135,-0.01448 -0.10135,-0.07239 v -0.130302 c 0,-0.04343 0.007,-0.05791 0.0362,-0.06515 0.0362,-0.0072 1.46228,-0.550164 1.46228,-0.550164 0.0941,-0.0362 0.12306,-0.07239 0.12306,-0.137541 v -0.658749 c 0,-0.05067 -0.007,-0.123063 -0.0796,-0.123063 -0.0145,0 -0.0362,0.02172 -0.0434,0.02172 v -0.01448 c 0,0 -1.36817,0.521208 -1.42609,0.542925 -0.0145,0 -0.0362,0.01448 -0.0434,0.01448 -0.029,0 -0.029,-0.02172 -0.029,-0.03619 v -0.152019 c 0,-0.04343 0.007,-0.05067 0.0507,-0.07239 l 0.89763,-0.347472 c 0.0724,-0.02896 0.12307,-0.101346 0.12307,-0.173736 v -0.738391 c 0,-0.05791 -0.0217,-0.08687 -0.0724,-0.08687 -0.0145,0 -0.0362,0 -0.0507,0.0072 0,0 -0.79629,0.296799 -0.818,0.304038 -0.0941,0 -0.13031,-0.123063 -0.13031,-0.209931 v -1.245067 c 0,-0.06515 -0.0652,-0.115824 -0.13754,-0.115824 -0.16649,0 -0.18097,0.07963 -0.18097,0.166497 v 1.353693 c -0.007,0.09411 -0.0362,0.209931 -0.11583,0.282321 -0.21717,0.07963 -0.5574,0.267843 -0.76009,0.267843 -0.0724,0.0362 -0.12306,0.108585 -0.12306,0.180975 v 0.738378 c 0,0.05067 0.029,0.08687 0.0724,0.08687 0.0217,0 0.029,0 0.0507,-0.01448 l 0.80353,-0.28956 c 0.0145,-0.01448 0.0362,-0.01448 0.0434,-0.01448 0.0217,0 0.029,0.01448 0.029,0.02172 v 0.159258 c 0,0.02896 0,0.05791 -0.029,0.07239 -0.0434,0.0072 -1.4478,0.542925 -1.4478,0.542925 -0.0869,0.02172 -0.12306,0.05067 -0.12306,0.115824",
        d8: "m 58.186602,55.809888 m 1.80251,-3.872865 c 0.0145,-0.01448 0.029,-0.01448 0.0579,-0.01448 0.0652,0 0.11583,0.02896 0.13754,0.09411 l 0.007,0.02172 0.0145,0.738378 v 0.745613 l 0.18098,-0.05067 c 0.10858,-0.02172 0.18821,-0.03619 0.23888,-0.03619 0.0724,0 0.0869,0.02896 0.11583,0.08687 0.0145,0.0072 0.0145,0.188214 0.0145,0.36195 0,0.180975 0,0.354711 -0.0145,0.369189 -0.029,0.06515 -0.0434,0.07239 -0.24613,0.123063 -0.25336,0.05791 -0.28956,0.07239 -0.28956,0.07963 0,0 0,0.09411 0,0.224409 0,0.03619 0,0.08687 0,0.14478 v 0.376428 l 0.0724,-0.02172 0.2968,-0.07963 c 0.15926,-0.02896 0.23165,-0.05067 0.26784,-0.05067 0.0362,0 0.0579,0.0072 0.0796,0.02896 0.0507,0.04343 0.0579,0.05067 0.0579,0.28956 0,0.04343 0,0.09411 0,0.152019 v 0.325755 l -0.007,0.02172 c -0.0145,0.02896 -0.0507,0.07239 -0.0796,0.07963 -0.0145,0 -0.19546,0.05067 -0.60084,0.152019 -0.0507,0.0072 -0.0869,0.02172 -0.0869,0.02172 0,0 0,0.115824 0,0.28956 0,0.02896 0,0.05791 0,0.08687 v 0.36195 l 0.18098,-0.0362 c 0.12306,-0.02896 0.18821,-0.05067 0.23888,-0.05067 0.0434,0 0.0724,0.02172 0.0869,0.05067 0.0434,0.0362 0.0434,0.01448 0.0434,0.296799 v 0.115824 0.09411 c 0,0.282321 0,0.267843 -0.0434,0.304038 -0.029,0.04343 -0.0145,0.04343 -0.35471,0.123063 -0.0651,0.02172 -0.13754,0.02896 -0.14478,0.0362 h -0.007 l -0.0145,0.752856 v 0.760095 l -0.007,0.02896 c -0.0217,0.05791 -0.0796,0.08687 -0.13754,0.08687 -0.0579,0 -0.10858,-0.02896 -0.13754,-0.08687 l -0.0145,-0.02896 v -0.716687 -0.716661 h -0.007 l -0.1665,0.04343 -0.30404,0.07239 c -0.0796,0.02896 -0.15926,0.03619 -0.15926,0.05067 -0.007,0 -0.007,0.03619 -0.007,0.774573 v 0.781812 l -0.0145,0.02172 c -0.029,0.05791 -0.0869,0.08687 -0.13755,0.08687 -0.0579,0 -0.11582,-0.02896 -0.14478,-0.08687 l -0.0145,-0.02172 v -0.745617 c 0,-0.680466 0,-0.745617 -0.007,-0.745617 0,0 0,0 0,0 -0.0796,0.03619 -0.35471,0.09411 -0.38367,0.09411 -0.0579,0 -0.10858,-0.02896 -0.13754,-0.09411 -0.0145,-0.01448 -0.0145,-0.01448 -0.0145,-0.36195 v -0.347472 l 0.0217,-0.02172 c 0.029,-0.07239 0.029,-0.07239 0.43434,-0.173736 l 0.0869,-0.01448 v -0.376428 c 0,-0.340233 0,-0.369189 -0.007,-0.369189 0,0 0,0 0,0 0,0 -0.0507,0.0072 -0.10859,0.02896 l -0.28232,0.07239 c -0.12306,0.02896 -0.18821,0.03619 -0.23165,0.03619 -0.029,0 -0.0507,-0.0072 -0.0796,-0.02896 -0.0434,-0.0362 -0.0507,-0.05067 -0.0507,-0.28956 0,-0.04343 0.007,-0.09411 0.007,-0.152019 v -0.325755 l 0.007,-0.01448 c 0.007,-0.03619 0.0362,-0.06515 0.0651,-0.07239 0.0145,-0.01448 0.20269,-0.05791 0.58636,-0.152019 l 0.0941,-0.02896 v -0.376428 c 0,-0.340233 0,-0.369189 -0.007,-0.369189 0,0 0,0 0,0 -0.0796,0.02172 -0.35471,0.09411 -0.38367,0.09411 -0.0579,0 -0.10858,-0.04343 -0.13754,-0.09411 -0.0145,-0.02172 -0.0145,-0.02896 -0.0145,-0.369189 v -0.340233 l 0.0217,-0.02172 c 0.029,-0.07239 0.029,-0.07239 0.43434,-0.173736 l 0.0869,-0.02896 v -0.752856 -0.752856 l 0.0145,-0.02896 c 0.029,-0.05067 0.0869,-0.09411 0.14478,-0.09411 0.0217,0 0.0434,0.01448 0.0579,0.02172 0.029,0.0072 0.0579,0.04343 0.0796,0.07239 l 0.0145,0.02896 v 0.709422 0.7239 l 0.0362,-0.0072 c 0.0217,-0.0072 0.13754,-0.04343 0.27508,-0.07239 l 0.28956,-0.06515 0.0434,-0.01448 v -0.781812 -0.781812 l 0.0145,-0.02172 c 0.0145,-0.02896 0.0362,-0.06515 0.0796,-0.07963 m -0.0941,2.960751 c 0,-0.202692 0,-0.369189 -0.007,-0.369189 v 0 c 0,0 -0.0724,0.02172 -0.15926,0.0362 l -0.31128,0.07963 c -0.0941,0.02172 -0.1665,0.04343 -0.1665,0.04343 0,0 0,0.09411 0,0.224409 0,0.05067 0,0.09411 0,0.159258 v 0.36195 l 0.0434,-0.01448 0.54292,-0.130302 0.0579,-0.01448 v -0.37643 m 0,1.672209 c 0,-0.28956 0,-0.369189 -0.007,-0.369189 v 0 c 0,0 -0.007,0 -0.029,0.0072 -0.029,0 -0.19545,0.05067 -0.4271,0.101346 l -0.1665,0.05067 h -0.0145 v 0.369189 0.376428 l 0.0362,-0.01448 c 0.0217,0 0.13754,-0.02896 0.27508,-0.07239 l 0.28956,-0.06515 0.0434,-0.01448 v -0.369189",
        gClef: "m 0,10.679239 m 3.513735,2.43414 c 0.221285,0 0.476097,-0.0201 0.67056,-0.0603 0.100584,-0.0201 0.120701,-0.0268 0.140817,0.0872 0.113996,0.65044 0.261519,1.48864 0.261519,1.94462 0,1.42829 -0.965607,1.60264 -1.535583,1.60264 -0.523036,0 -0.771144,-0.15423 -0.771144,-0.28164 0,-0.0671 0.08717,-0.0939 0.308458,-0.16764 0.301752,-0.0872 0.643738,-0.34198 0.643738,-0.90525 0,-0.52974 -0.33528,-0.98572 -0.925373,-0.98572 -0.643738,0 -1.032663,0.51633 -1.032663,1.11313 0,0.62362 0.375514,1.57581 1.837335,1.57581 0.643737,0 1.897685,-0.29505 1.897685,-1.93121 0,-0.55657 -0.174346,-1.46853 -0.27493,-2.07203 -0.02012,-0.114 -0.01341,-0.10058 0.120701,-0.16093 0.979017,-0.38893 1.622755,-1.20701 1.622755,-2.30003 0,-1.2338301 -0.905256,-2.3268401 -2.326843,-2.3268401 -0.248107,0 -0.248107,0 -0.281635,-0.17434 L 3.62773,6.6693789 c -0.01341,-0.114 0,-0.12071 0.06035,-0.18106 1.046074,-0.97231 1.837334,-2.19943 1.837334,-3.68137 0,-0.8382 -0.234696,-1.66969 -0.630326,-2.24637997 -0.147523,-0.21458001 -0.39563,-0.48280001 -0.50292,-0.48280001 -0.134112,0 -0.435864,0.24811 -0.623621,0.46269001 C 3.051048,1.3317189 2.816352,2.5387289 2.816352,3.5445689 c 0,0.55656 0.07376,1.18689 0.140818,1.58252 0.02012,0.11399 0.02682,0.13411 -0.08717,0.23469 C 1.475235,6.5084389 3e-6,7.8897889 3e-6,9.8411193 c 0,1.6763997 1.146658,3.2723397 3.513735,3.2723397 m -2.742591,-2.6286 c 0,-0.5699697 0.100584,-1.3344101 0.898551,-2.2396701 0.583387,-0.64374 1.025957,-1.00584 1.475232,-1.36794 0.100584,-0.0805 0.120701,-0.0671 0.140817,0.0335 l 0.201168,1.24054 c 0.02682,0.18105 0.02682,0.17434 -0.147523,0.22799 -0.844905,0.28834 -1.40147,1.05277 -1.40147,1.8775601 0,0.86503 0.455981,1.48194 1.113129,1.70993 0.08047,0.0268 0.194463,0.0536 0.261519,0.0536 0.07376,0 0.113995,-0.0469 0.113995,-0.10729 0,-0.0671 -0.07376,-0.0939 -0.140818,-0.1207 -0.409041,-0.17434 -0.697382,-0.59009 -0.697382,-1.03266 0,-0.55657 0.375514,-0.9656097 0.965606,-1.1332497 0.154229,-0.0402 0.174346,-0.0268 0.194463,0.0805 l 0.482803,2.8766997 c 0.02012,0.10729 0.0067,0.10729 -0.134112,0.13412 -0.154229,0.0268 -0.348691,0.0469 -0.543154,0.0469 -1.689811,0 -2.782824,-0.93879 -2.782824,-2.27991 M 4.539695,1.5730389 c 0.315163,0 0.576681,0.26152 0.576681,0.79126 0,1.0729 -0.918667,1.94462 -1.6764,2.60848 -0.06706,0.0604 -0.107289,0.0469 -0.127406,-0.0805 -0.04023,-0.24811 -0.06035,-0.57668 -0.06035,-0.88514 0,-1.50876 0.697382,-2.43413 1.287475,-2.43413 M 4.258059,9.5526693 c 0.784556,0.0671 1.428293,0.7242097 1.428293,1.5691097 0,0.61021 -0.368808,1.09972 -0.905256,1.37465 -0.113995,0.0536 -0.134112,0.0536 -0.154229,-0.0603 L 4.15077,9.6868393 c -0.02012,-0.12071 -0.0067,-0.14753 0.107289,-0.13412",
        numbers: [
            "",
            "",
            "",
            "",
            "",
            "",
            "",
            "",
            "",
            ""
        ]
    };

    const notePositions = {
        e4: 4,
        f4: 3.5,
        g4: 3,
        a4: 2.5,
        b4: 2,
        c5: 1.5,
        d5: 1,
        e5: 0.5,
        f5: 0
    };

    function Note(pitch, duration) {
        let noteRoot = '';
        let noteOctave = 0;
        let noteComma = '';
        let durParts = duration.split('/');
        let durNum = parseInt(durParts[0]);
        let durDen = parseInt(durParts[1]);

        if (pitch.includes('#') || pitch.includes('b')) {
            noteComma = pitch.substr(-2);
        }

        noteRoot = pitch.replace(noteComma, '');
        noteOctave = parseInt(noteRoot.substr(-1));
        noteRoot = noteRoot.slice(0, -1).toLowerCase();
        if (noteComma) {
            noteComma = noteComma.replace('#', 'd');
        }

        this.toStr = function () {
            if (noteComma) {
                return [noteRoot, noteOctave, noteComma, durNum, durDen].join(':');
            } else {
                return [noteRoot, noteOctave, durNum, durDen].join(':');
            }
        };

        this.getNote = function () {
            return noteRoot + noteOctave;
        }

        this.getAcc = function () {
            return noteComma;
        }
    }

    function Measure(timeSig) {
        let parts = timeSig.split('/');
        let timeSignature = {
            num: parseInt(parts[0]),
            den: parseInt(parts[1])
        };

        let notes = [];

        this.addNote = function (pitch, dur) {
            let note = new Note(pitch, dur);
            notes.push(note);
        };

        this.getNotes = function () {
            return notes;
        };

        this.toStr = function () {
            return [timeSignature.num, timeSignature.den].join(':');
        };

        this.getRequiredWidth = function (plh) {
            return plh * 6 * (notes.length + 2);
        };
    }


    function SatirObject(paper, configs, left, top, width) {
        this.paper = paper;
        this.configs = configs;
        this.left = left;
        this.top = top;
        this.width = width;
        this.lines = [];
        this.vLineLeft = null;
        this.vLineRight = null;
        this.solAnahtari = null;

        this.draw = function (accidentals, timeSig) {
            // 5 lines

            for (let i = 0; i < 5; i++) {
                let x1 = this.left;
                let y1 = this.top + i * this.configs.porteLineHeight;
                let x2 = this.left + this.width;

                let line = this.paper.line(x1, y1, x2, y1);

                line.attr({
                    stroke: this.configs.porteLineColor,
                    strokeWidth: this.configs.lineThickness
                });

                this.lines.push(line);
            }

            let porteLiHe = this.configs.porteLineHeight;
            let porteHeight = 4 * porteLiHe;

            // Left & Right vertical lines
            let x1 = this.left;
            let y1 = this.top;
            let y2 = this.top + porteHeight;
            this.vLineLeft = this.paper.line(x1, y1, x1, y2);
            this.vLineLeft.attr({
                stroke: this.configs.porteLineColor,
                strokeWidth: this.configs.lineThickness
            });

            x1 = this.left + this.width;
            this.vLineRight = this.paper.line(x1, y1, x1, y2);
            this.vLineRight.attr({
                stroke: this.configs.porteLineColor,
                strokeWidth: this.configs.lineThickness
            });

            // Sol Anahtari
            this.solAnahtari = this.paper.path(symbols.gClef);

            let solHeight = this.solAnahtari.getBBox().height;
            let solWidth = this.solAnahtari.getBBox().width;

            let scaleFactor = (porteHeight) * (74 / 40) / solHeight;
            let offsetLeft = scaleFactor * solWidth;

            let scaleStr = 's' + scaleFactor;

            let trLeft = this.left + (offsetLeft / 2);
            let trTop = this.top + Math.abs(solHeight - porteHeight) / 2;
            let translateStr = 't ' + trLeft + ' ' + trTop;

            this.solAnahtari.transform(translateStr + ' ' + scaleStr);
            this.solAnahtari.attr({
                fill: this.configs.mainColor
            });

            // accidentals
            for (let i = 0; i < accidentals.notes.length; i++) {
                let note = accidentals.notes[i];
                let notePos = notePositions[note.getNote()];

                let accPath = symbols[note.getAcc()];
                let accSymbol = this.paper.path(accPath);
                scaleFactor = parseFloat((porteLiHe / 2.75).toFixed(2));

                let left = this.left + porteLiHe + offsetLeft + (i * porteLiHe * 1.5);
                let top = this.top + (notePos * porteLiHe);

                translateStr = 't ' + left + ' ' + top;
                scaleStr = 's' + scaleFactor + ' 0 0';
                accSymbol.transform(translateStr + ' ' + scaleStr);
                accSymbol.attr({
                    fill: this.configs.mainColor
                });
            }

        }
    }


    function TmmScore(containerSelector) {
        let configs = {
            padding: {top: 20, right: 20, bottom: 20, left: 20},
            lineThickness: 0.5,
            porteLineHeight: 10,
            mainColor: "#3b4552",
            porteLineColor: "#4e5872",
            paperBgColor: "#f6f7f6",
            initialSatirCount: 2
        };

        // prep work
        let windowWidth = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
        let scorePaperWidth = 1000;
        if (windowWidth < 1100) {
            scorePaperWidth = windowWidth - 100;
        }

        let svgElem = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
        let svgID = 'svg-tmm-score';
        svgElem.setAttribute('id', svgID);
        svgElem.style.backgroundColor = configs.paperBgColor;
        svgElem.style.width = scorePaperWidth + 'px';

        document.querySelector(containerSelector).append(svgElem);

        let paper = Snap('#' + svgID);
        // eof prep work

        let measures = [];
        let satirlar = [];
        let timeSignatures = [];
        let accidentals = [];

        this.setAccidentals = function (accidentalsArr) {
            let acci = {
                notes: [],
                startsAt: 0
            };

            for (let accidental of accidentalsArr) {
                let note = new Note(accidental, '0/1');
                acci.notes.push(note);
            }

            acci.startsAt = measures.length;
            accidentals.push(acci);
        };

        this.setMeter = function (meter) {
            let parts = meter.split('/');
            let timeSignature = {
                num: parseInt(parts[0]),
                den: parseInt(parts[1]),
                startsAt: measures.length
            };
            timeSignatures.push(timeSignature);
        };

        this.addMeasure = function (measure) {
            measures.push(measure);
        };

        this.init = function () {
            // create satir objects
            let pLeft = configs.padding.left;
            let pRight = configs.padding.right;
            let pTop = configs.padding.top;
            let satirWidth = scorePaperWidth - pLeft - pRight;
            let numOfReqLines = 1;

            let remainingWidth = satirWidth;
            for (let measure of measures) {
                let minWidth = measure.getRequiredWidth(configs.porteLineHeight);
                if (minWidth > remainingWidth) {
                    numOfReqLines += 1;
                    remainingWidth = satirWidth;
                }
                remainingWidth = remainingWidth - minWidth;
            }

            svgElem.style.height = (configs.padding.top + configs.padding.bottom) + (numOfReqLines * 17 * configs.porteLineHeight) + 'px';

            for (let i = 0; i < numOfReqLines; i++) {
                let offsetTop = pTop + (6 * configs.porteLineHeight) + (i * 17 * configs.porteLineHeight);
                let satir = new SatirObject(paper, configs, pLeft, offsetTop, satirWidth);
                satirlar.push(satir);
            }
            // eof satir objects
        };

        this.draw = function () {
            for (let satir of satirlar) {
                satir.draw(accidentals[0], timeSignatures[0]);
            }
        };
    }


    let tmmScore = new TmmScore('#dv-tmm-wrapper');

    tmmScore.setAccidentals(['B4b4', 'F5#4', 'C5#4']);
    tmmScore.setMeter('12/8');

    let measure = new Measure('9/8');
    measure.addNote('La4', '1/16');
    measure.addNote('Si4b4', '1/16');
    measure.addNote('Do5#4', '1/8');
    measure.addNote('Re5', '1/16');
    measure.addNote('Mi5', '1/16');
    measure.addNote('Re5', '1/8');
    measure.addNote('Fa5', '1/8');
    measure.addNote('Mi5', '1/8');
    measure.addNote('Re5', '1/4');
    measure.addNote('Do5#4', '1/8');

    tmmScore.addMeasure(measure);
    tmmScore.addMeasure(new Measure('9/8'));
    tmmScore.addMeasure(new Measure('9/8'));
    tmmScore.addMeasure(new Measure('9/8'));

    tmmScore.init();
    tmmScore.draw();

</script>
</body>
</html>